{% extends 'base.html.twig' %}

{% block title %}Accueil | {{ parent() }}{% endblock %}

{% block body %}
    <div class="container">
        <form class="form-inline mt-4 row justify-content-center" action="">
            <input type="text" name="search" id="search" class="mr-3 form-control" placeholder="Recherche">
            <select name="couleur" class="custom-select custom-select-md mr-3">
                <option value="All" selected>Toutes les couleurs</option>
            </select>
            <select name="marque" class="custom-select custom-select-md mr-3">
                <option value="All" selected>Toutes les marques</option>
            </select>
            <select name="region" class="custom-select custom-select-md mr-3" id="regions">
                <option value="All" selected>Toute la France</option>
            </select>
            <select name="departement" class="custom-select custom-select-md mr-3" id="departement">
                <option value="All" selected>Toute la région</option>
            </select>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="interieure" name="interieure">
                <label class="form-check-label  mr-3" for="interieure">
                    Peinture Intérieure
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="exterieure" name="exterieure">
                <label class="form-check-label mr-3" for="exterieure">
                    Peinture extérieure
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input " type="checkbox" value="" id="outils" name="outils">
                <label class="form-check-label mr-3" for="outils">
                    Outils du peintre
                </label>
            </div>
            <div>
                <button class="btn btn-light text-dark bouton pull-right" type="submit">Rechercher</button>
            </div>
        </form>

        <ul id="listHome">
            {% for product in products %}
                <li id="cardHome">
                    <div class="produits mt-5">
                        <div class="card shadow p-3 mb-5 bg-white rounded " style="width: 18rem;">
                            <img src="{{ product.picture }}" class="card-img-top" alt="...">
                            <div class="card-body">
                                <h5 class="card-title">{{ product.title }}</h5>
                                <p class="card-text">{{ product.description }}</p>
                            </div>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item">{{ product.brand.name }}</li>
                                <li class="list-group-item">{{ product.price }}</li>
                            </ul>
                            <div class="card-body">
                                <a href="#" class="card-link">Card link</a>
                            </div>
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>

{% endblock %}
{% block javascripts %}
    <script>
        var regions = $("#regions");

        $(document).ready(function () {
            regionsCall();
            regions.on("mouseout", function () {
                departementCall();
            });
        });

        /**
         * fonction affichant les régions via l'api
         */
        function regionsCall() {

            $.ajax({
                url: 'https://geo.api.gouv.fr/regions?fields=nom',
                method: 'get',
                dataType: "json",
                contentType: "application/json"
            }).done(function (result) {
                for (var i = 0; i < result.length; i++) {
                    var element = $('<option></option>').text(result[i].nom);
                    regions.append(element);
                }
            });

        }

        /**
         * fonction affichant les départements via la région sélectionnée
         */
        function departementCall() {
            var region = $('#regions option:selected').text();
            $('#departement').text('');
            $.ajax({
                url: 'https://geo.api.gouv.fr/regions?nom=' + region + '&fields=nom',
                method: 'get',
                dataType: "json",
                contentType: "application/json"
            }).done(function (result) {
                var code = result[0].code;
                $.ajax({
                    url: 'https://geo.api.gouv.fr/departements?codeRegion=' + code + '&fields=nom',
                    method: 'get',
                    dataType: "json",
                    contentType: "application/json"
                }).done(function (res) {
                    var tous = $('<option val="all"></option>').text("Tous les départements");
                    $('#departement').append(tous);
                    for (var i = 0; i < res.length; i++) {
                        var element = $('<option></option>').text(res[i].nom + '-' + res[i].code);
                        $('#departement').append(element);
                    }
                });
            })
        }
    </script>
{% endblock %}
